---
options:
  supported_version: 4.3.5.0
---
schema_template:
    create table products(id bigint, name string, category string, price bigint, stock integer, primary key(id))
    create index price_idx as select price from products order by price
    create index category_idx as select category from products order by category
    create index name_idx as select name from products order by name
---
setup:
  steps:
    - query: insert into products
            values (1, 'Widget A', 'Electronics', 100, 50),
                   (2, 'Widget B', 'Electronics', 150, 30),
                   (3, 'Gadget X', 'Electronics', 200, 20),
                   (4, 'Tool A', 'Hardware', 80, 100),
                   (5, 'Tool B', 'Hardware', 120, 15),
                   (6, 'Book A', 'Media', 25, 200),
                   (7, 'Book B', 'Media', 30, 150)
---
test_block:
  name: operators-documentation-tests
  preset: single_repetition_ordered
  tests:
    # BETWEEN with numbers
    -
      - query: SELECT name, price
              FROM products
              WHERE price BETWEEN 100 AND 150
              ORDER BY price
      - supported_version: 4.3.5.0
      - result: [{name: "Widget A", price: 100},
                 {name: "Tool B", price: 120},
                 {name: "Widget B", price: 150}]

    # NOT BETWEEN
    -
      - query: SELECT name, price
              FROM products
              WHERE price NOT BETWEEN 100 AND 150
              ORDER BY price
      - supported_version: 4.3.5.0
      - result: [{name: "Book A", price: 25},
                 {name: "Book B", price: 30},
                 {name: "Tool A", price: 80},
                 {name: "Gadget X", price: 200}]

    # BETWEEN with equal bounds
    -
      - query: SELECT name, price
              FROM products
              WHERE price BETWEEN 100 AND 100
      - supported_version: 4.3.5.0
      - result: [{name: "Widget A", price: 100}]

    # Empty Range
    -
      - query: SELECT name, price
              FROM products
              WHERE price BETWEEN 150 AND 100
      - supported_version: 4.3.5.0
      - result: []

    # Combined with OR
    -
      - query: SELECT name, price
              FROM products
              WHERE price BETWEEN 80 AND 100 OR price BETWEEN 180 AND 220 ORDER BY PRICE
      - supported_version: 4.3.5.0
      - result: [ {name: "Tool A", price: 80}, {name: "Widget A", price: 100}, {name: "Gadget X", price: 200} ]

    # LIKE prefix matching
    -
      - query: SELECT name
              FROM products
              WHERE name LIKE 'W%'
              ORDER BY name
      - supported_version: 4.3.5.0
      - result: [{name: "Widget A"},
                 {name: "Widget B"}]

    # LIKE suffix matching
    -
      - query: SELECT name
              FROM products
              WHERE name LIKE '%B'
              ORDER BY name
      - supported_version: 4.3.5.0
      - result: [{name: "Book B"},
                 {name: "Tool B"},
                 {name: "Widget B"}]

    # LIKE substring matching
    -
      - query: SELECT name
              FROM products
              WHERE name LIKE '%oo%'
              ORDER BY name
      - supported_version: 4.3.5.0
      - result: [{name: "Book A"},
                 {name: "Book B"},
                 {name: "Tool A"},
                 {name: "Tool B"}]

    # NOT LIKE
    -
      - query: SELECT name
              FROM products
              WHERE name NOT LIKE 'Widget%'
              ORDER BY name
      - supported_version: 4.3.5.0
      - result: [{name: "Book A"},
                 {name: "Book B"},
                 {name: "Gadget X"},
                 {name: "Tool A"},
                 {name: "Tool B"}]

    # IN with numbers
    -
      - query: SELECT name, price
              FROM products
              WHERE id IN (1, 3, 5)
              ORDER BY id
      - supported_version: 4.3.5.0
      - result: [{name: "Widget A", price: 100},
                 {name: "Gadget X", price: 200},
                 {name: "Tool B", price: 120}]

    # IN with strings
    -
      - query: SELECT name, category
              FROM products
              WHERE category IN ('Electronics', 'Media')
              ORDER BY name
      - supported_version: 4.3.5.0
      - result: [{name: "Book A", category: "Media"},
                          {name: "Book B", category: "Media"},
                          {name: "Gadget X", category: "Electronics"},
                          {name: "Widget A", category: "Electronics"},
                          {name: "Widget B", category: "Electronics"}]

    # NOT IN
    -
      - query: SELECT name, category
              FROM products
              WHERE category NOT IN ('Electronics', 'Media')
              ORDER BY name
      - supported_version: 4.3.5.0
      - result: [{name: "Tool A", category: "Hardware"},
                 {name: "Tool B", category: "Hardware"}]

    # IS DISTINCT FROM - basic comparison
    -
      - query: SELECT name, price
              FROM products
              WHERE price IS DISTINCT FROM 100
              ORDER BY name
      - supported_version: 4.3.5.0
      - result: [{name: "Book A", price: 25},
                 {name: "Book B", price: 30},
                 {name: "Gadget X", price: 200},
                 {name: "Tool A", price: 80},
                 {name: "Tool B", price: 120},
                 {name: "Widget B", price: 150}]

    # IS NOT DISTINCT FROM - equality check
    -
      - query: SELECT name, price
              FROM products
              WHERE price IS NOT DISTINCT FROM 100
      - supported_version: 4.3.5.0
      - result: [{name: "Widget A", price: 100}]

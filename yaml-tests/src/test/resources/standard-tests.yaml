#
# standard-tests.yaml
#
# This source file is part of the FoundationDB open source project
#
# Copyright 2021-2024 Apple Inc. and the FoundationDB project authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
- connect: "jdbc:embed:/__SYS?schema=CATALOG"
---
- query: drop schema template standard_tests_template
---
- query: create schema template standard_tests_template
    create table t1(id int64, col1 int64, col2 int64, primary key(id))
    create index i1 as select col1 from t1
---
- query: drop database /STANDARD_YAML
---
- query: create database /STANDARD_YAML
---
- query: create schema /STANDARD_YAML/test with template standard_tests_template
---
- connect: "jdbc:embed:/STANDARD_YAML?schema=TEST"
---
- insert: [{ID: 1, 10, 1},
           {ID: 2, 10, 2},
           {ID: 3, 10, 3},
           {ID: 4, 10, 4},
           {ID: 5, 10, 5},
           {ID: 6, 20, 6},
           {ID: 7, 20, 7},
           {ID: 8, 20, 8},
           {ID: 9, 20, 9},
           {ID: 10, 20, 10},
           {ID: 11, 20, 11},
           {ID: 12, 20, 12},
           {ID: 13, 20, 13}]
- table: T1
---
- query: select * from (select * from (select * from T1) as x where ID = 5) as y;
- result: [{ID: !l 5, !l 10, !l 5}]
---
- query: select * from (select * from (select * from T1) as x) as y where ID = 5;
- result: [{ID: !l 5, !l 10, !l 5}]
---
- query: select count(*) from (select * from (select * from (select * from T1  where ID = 5) as x) as y) as z;
- result: [{!l 1}]
---
- query: select * from (select * from (select * from (select * from T1  where ID > 10) as x) as y) as z;
- result: [{ID: !l 11, !l 20, !l 11}, {ID: !l 12, !l 20, !l 12}, {ID: !l 13, !l 20, !l 13}]
---
- connect: "jdbc:embed:/__SYS?schema=CATALOG"
---
- query: drop schema template standard_tests_template
---
- query: drop database /STANDARD_YAML
...

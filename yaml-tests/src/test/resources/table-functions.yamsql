#
# table-functions.yamsql
#
# This source file is part of the FoundationDB open source project
#
# Copyright 2021-2025 Apple Inc. and the FoundationDB project authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
test_block:
  connect: "jdbc:embed:/__SYS?schema=CATALOG"
  name: table-functions
  tests:
    -
      - query: select * from values (1, 2.0, 'foo'), (10, 90.2, 'bar')
      - result: [{1, 2.0, 'foo'},
                 {10, 90.2, 'bar'}]
    -
      - query: select * from values (1, 2.0, 'foo'), (10, 90.2, 'bar') as A(B, C, D)
      - result: [{B: 1, C: 2.0, D: 'foo'},
                 {B: 10, C: 90.2, D: 'bar'}]
    -
      - query: select * from values (1, 2.0, [42, 43, 44]), (11, 3.0, [420, 430, 440])
      - result: [{1, 2.0, [42, 43, 44]},
                 {11, 3.0, [420, 430, 440]}]
#    -
#      - query: select * from values (1, 2.0, [42, 43, 44]), (11, 3.0, [420, 430, 440])  as A(B, C, W)
#      - result: [{B: 1, C: 2.0, W: [42, 43, 44]},
#                 {B: 11, C: 3.0, W: [420, 430, 440]}]
    -
      - query: select * from values (1, 2.0, (3, 4, 'foo')), (10, 90.2, (5, 6.0, 'bar')) as A(B, C, W(X, Y, Z))
      - result: [{B: 1, C: 2.0, W: {X: 3, Y: 4.0, Z: 'foo'}},
                 {B: 10, C: 90.2, W: {X: 5, Y: 6.0, Z: 'bar'}}]
    -
      - query: select B, C, W from values (1, 2.0, (3, 4, 'foo')), (10, 90.2, (5, 6.0, 'bar')) as A(B, C, W(X, Y, Z))
      - result: [{B: 1, C: 2.0, W: {X: 3, Y: 4.0, Z: 'foo'}},
                 {B: 10, C: 90.2, W: {X: 5, Y: 6.0, Z: 'bar'}}]
    -
      - query: select A.B, C, W from values (1, 2.0, (3, 4, 'foo')), (10, 90.2, (5, 6.0, 'bar')) as A(B, C, W(X, Y, Z))
      - result: [{B: 1, C: 2.0, W: {X: 3, Y: 4.0, Z: 'foo'}},
                 {B: 10, C: 90.2, W: {X: 5, Y: 6.0, Z: 'bar'}}]
    -
      - query: select A.B, C as Q, W.X from values (1, 2.0, (3, 4, 'foo')), (10, 90.2, (5, 6.0, 'bar')) as A(B, C, W(X, Y, Z))
      - result: [{B: 1, Q: 2.0, X: 3},
                 {B: 10, Q: 90.2, X: 5}]
    -
      - query: select * from (select A.B, C as Q, W.X from values (1, 2.0, (3, 4, 'foo')), (10, 90.2, (5, 6.0, 'bar')) as A(B, C, W(X, Y, Z))) as u
      - result: [{B: 1, Q: 2.0, X: 3},
                 {B: 10, Q: 90.2, X: 5}]
...
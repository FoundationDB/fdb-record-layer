#
# relational
#
# This source file is part of the FoundationDB open source project
#
# Copyright 2021-2024 Apple Inc. and the FoundationDB project authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

#!/bin/sh

# Check we are in a 'built' environment. If so, run application start script
# generated by the build.
# Script is generic. Same script is under fdb-relational-cli and fdb-relational-server.
# Script is a few lines only. Bulk is figuring out where-am-I? Hence duplication. 
# This discovery of APP_HOME is kinda overkill -- taken from the gradle
# template used as bones of generated app start script..

# Resolve links: $0 may be a link
app_path=$0

# Need this for daisy-chained symlinks.
while
    APP_HOME=${app_path%"${app_path##*/}"}  # leaves a trailing /; empty if no leading path
    [ -h "$app_path" ]
do
    ls=$( ls -ld "$app_path" )
    link=${ls#*' -> '}
    case $link in             #(
      /*)   app_path=$link ;; #(
      *)    app_path=$APP_HOME$link ;;
    esac
done

APP_HOME=$( cd "${APP_HOME:-./}.." && pwd -P ) || exit
APP_NAME=`basename "$0"`

target="${APP_HOME}/.out/install/${APP_NAME}/bin/${APP_NAME}"
if [ ! -x "${target}" ]; then
  echo "Please build before running this script (Failed to find executable script at ${target})"
fi
exec "${target}" "$@"
